javascript:
  google.load('visualization', '1.0', {'packages':['corechart']});
  google.setOnLoadCallback(drawOrdersChart);

  function drawOrdersChart() {
    
    $.get(
      'http://thirdfloor.herokuapp.com/data_points.json?name=daily_sales&limit=500'
    ).done(function(returned_data) {
      
      var data = new google.visualization.DataTable();
      data.addColumn('datetime', 'Time');
      data.addColumn('number', 'Sales');

      var chart_data = [];

      var previous_value = undefined;

      var smoothed_data = [];
      var smoothed_data_threshold = 15;

      for (var i in returned_data.data_points.reverse()) {
        var dp = returned_data.data_points[i];
        var dpd = dp.data;
        var current_value = parseFloat(dpd.sales);
        
        if (previous_value == undefined) {
          previous_value = current_value;
          continue;
        }

        var new_value = current_value - previous_value;
        previous_value = current_value;

        smoothed_data.push(new_value);
        if (smoothed_data.length >= smoothed_data_threshold) {

          var summed_value = smoothed_data.reduce(
            function(previousValue, currentValue, index, array){
              return previousValue + currentValue;
            }, 0
          );
          
          smoothed_data = [];

          chart_data.push([
            new Date(Date.parse(dp.created_at)),
            summed_value
          ]);
        }
      }
      data.addRows(chart_data);
      // Instantiate and draw our chart, passing in some options.
      var chart = new google.visualization.LineChart(document.getElementById('sales_chart_div'));
      chart.draw(data, {
        'title':'Sales Today',
        'width':'100%',
        'height':150,
        'colors': ['green'],
        //'lineWidth': 1,
        'trendlines': { 0: { 'color': 'blue', 'lineWidth':3, 'opacity': 0.5, } },
        'curveType':'function',
        'titleTextStyle': { 'color' : '#FFFFFF'},
        'backgroundColor':'rgb(15,15,20)',
        'legend': { position: 'none' },
        'vAxis': {
          'title': 'Dollars',
          'baselineColor': 'white',
          'textStyle': { color: 'white' },
          'titleTextStyle': { color: 'white' },
          'gridlines': { color: 'transparent'}
        },
        'hAxis': {
          'baselineColor': 'white',
          'textStyle': { color: 'white' },
          'gridlines': { color: 'transparent'}
        }
      });
    });
  }

#sales_chart_div
